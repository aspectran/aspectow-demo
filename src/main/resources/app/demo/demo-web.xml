<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE aspectran PUBLIC "-//ASPECTRAN//DTD Aspectran 9.0//EN"
        "https://aspectran.com/dtd/aspectran-9.dtd">
<aspectran>

    <description>
        Aspectran configuration to configure the web environment.
        Note that names of translets that match the request URI always start with a forward slash (/).
    </description>

    <bean id="jspViewDispatcher" class="com.aspectran.web.support.view.JspViewDispatcher">
        <description>
            Register a JSP View Dispatcher.
        </description>
        <property name="prefix">/WEB-INF/jsp/</property>
        <property name="suffix">.jsp</property>
    </bean>

    <aspect id="webTransletSettings">
        <description>
            This aspect is for injecting default settings into translets running in the web environment.
        </description>
        <joinpoint>
            pointcut: {
                +: /**
            }
        </joinpoint>
        <settings>
            <setting name="characterEncoding" value="utf-8"/>
            <setting name="viewDispatcher" value="jspViewDispatcher"/>
            <setting name="proxyProtocolAware" value="true"/>
        </settings>
    </aspect>

    <bean id="defaultMultipartFormDataParser"
          class="com.aspectran.web.support.multipart.inmemory.InMemoryMultipartFormDataParserFactoryBean">
        <description>
            A default multipart form data parser that applies to all unconfigured multipart requests.
            Inspired by Spring Boot's defaults for a sensible security baseline.
        </description>
        <property name="maxRequestSize" value="10MB"/>
        <property name="maxFileSize" value="1MB"/>
        <property name="allowedFileExtensions" value="txt,log,csv,md,json,xml,jpg,jpeg,png,gif,pdf,doc,docx,xls,xlsx,ppt,pptx"/>
    </bean>

    <aspect id="defaultMultipartPostSettings">
        <description>
            This aspect is for injecting default settings into all POST requests.
        </description>
        <joinpoint>
            methods: [
                POST
            ]
            pointcut: {
                +: /**
            }
        </joinpoint>
        <settings>
            <setting name="multipartFormDataParser" value="defaultMultipartFormDataParser"/>
        </settings>
    </aspect>

    <append resource="app/demo/home/main.xml"/>
    <append resource="app/demo/examples/hello-world.xml"/>
    <append resource="app/demo/examples/gs-rest-service.xml"/>
    <append resource="app/demo/examples/file-upload.xml"/>
    <append resource="app/demo/terminal/translet-interpreter.xml"/>
    <append resource="app/demo/terminal/terminal-commands.xml"/>
    <append resource="app/demo/skylark/skylark.xml"/>
    <append resource="app/demo/chat/chat.xml"/>

</aspectran>
